name: Generate AI Translations

on:
  workflow_dispatch:    # ?섎룞 ?ㅽ뻾
  push:
    branches: [main]    # ?꾩슂???곕씪 釉뚮옖移?議곗젙

jobs:
  generate-translations:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: yarn

      - name: Enable corepack
        run: corepack enable

      - name: Install deps (Yarn)
        run: yarn install --frozen-lockfile

      - name: Generate AI translations
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          NOTION_API_TOKEN: ${{ secrets.NOTION_API_TOKEN }}                # ?좏깮
          NOTION_TRANSLATION_DATABASE_ID: ${{ secrets.NOTION_TRANSLATION_DATABASE_ID }}  # ?좏깮
          AI_TRANSLATIONS_BACKGROUND: "0"    # ?앹꽦 媛뺤젣
          AI_TRANSLATIONS_DISABLED: ""       # 李⑤떒 ?댁젣
        run: yarn run generate:translations
        
      - name: Trigger Vercel Deploy Hook
        if: env.VERCEL_DEPLOY_HOOK_URL != ''
        env:
          VERCEL_DEPLOY_HOOK_URL: ${{ secrets.VERCEL_DEPLOY_HOOK_URL }}
        run: curl -X POST "$VERCEL_DEPLOY_HOOK_URL"

